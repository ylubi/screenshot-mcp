# Screenshot MCP 项目提示词总结

本文档记录了在开发 Screenshot MCP 项目过程中使用的关键提示词和开发流程。

## 项目开发阶段

### 阶段 0：项目概念和 Spec 启动

**最初提示词（推测）：**
```
我想做一个截图的 MCP 服务器。使用中文。
```

**说明：** 这是项目的起点，用户表达了创建 MCP 截图服务器的意图。

**Kiro 的响应：**
- 识别这是一个新项目需求
- 启动 Spec 创建流程
- 引导用户完善需求

---

### 阶段 1：需求文档创建

**隐式规则（Kiro Spec 模式）：**
```
专注于创建新的规范文件或识别现有规范进行更新。
如果开始新规范，在 .kiro/specs 目录中创建 requirements.md 文件，
包含清晰的用户故事和验收标准。
```

**执行内容：**
- 创建 `.kiro/specs/screenshot-mcp/requirements.md`
- 定义 7 个核心需求：
  1. 窗口截图功能
  2. 区域截图功能
  3. MCP 协议集成
  4. 图像格式和编码
  5. 错误处理和验证
  6. 跨平台支持
  7. 窗口发现功能
- 每个需求包含用户故事和验收标准

**关键决策：**
- 使用 MCP (Model Context Protocol) 协议
- 支持三种截图方式：窗口、区域、列表
- 跨平台支持（Windows、macOS、Linux）
- 使用 Base64 编码的 PNG 格式

---

### 阶段 2：设计文档创建

**提示词：**
```
继续
```

**隐式规则（Kiro Spec 模式）：**
```
你正在进行设计阶段。
创建 design.md 文件，将需求转换为技术架构。
包括组件图、接口和数据模型。
```

**执行内容：**
- 创建 `.kiro/specs/screenshot-mcp/design.md`
- 定义系统架构（5 层架构）
- 设计组件和接口
- 定义数据模型和错误处理策略
- 规划测试策略（单元测试 + 基于属性的测试）
- 定义 9 个正确性属性

**架构设计：**
1. MCP 协议层
2. 工具注册层
3. 工具实现层
4. 平台抽象层
5. 平台实现层

**测试策略：**
- 使用 fast-check 进行基于属性的测试
- 每个属性最少 100 次迭代
- 单元测试覆盖特定示例和边缘情况

---

### 阶段 3：任务规划

**提示词：**
```
检查更新一下 .kiro\specs\screenshot-mcp\tasks.md 状态
```

**隐式规则（Kiro Spec 模式）：**
```
你正在进行实施计划。
确保每个任务都是可执行的，引用具体需求，
并且只专注于编码活动。
```

**执行内容：**
- 创建 `.kiro/specs/screenshot-mcp/tasks.md`
- 将设计分解为 17 个可执行任务
- 定义任务优先级和依赖关系
- 每个任务引用具体需求编号

**任务分解：**
1. 项目初始化和核心结构
2. 实现 MCP 服务器核心
3. 实现工具注册表
4. 检查点 - 确保测试通过
5. 实现平台抽象层接口
6. 实现 Windows 平台截图
7. 实现 macOS 平台截图
8. 实现 Linux 平台截图
9. 检查点 - 平台实现测试
10. 实现图像处理工具
11. 实现窗口截图工具
12. 实现区域截图工具
13. 实现窗口列表工具
14. 检查点 - 工具测试
15. 集成和服务器启动
16. 文档和示例
17. 最终检查点

---

### 阶段 4：项目初始化和实现

**提示词：**
```
继续
```

**说明：** 开始实际的代码实现，按照 tasks.md 中的任务顺序进行。

**执行内容：**
- 初始化 npm 项目（package.json, tsconfig.json）
- 安装依赖（TypeScript、@modelcontextprotocol/sdk、node-screenshots、pngjs 等）
- 创建 `src/` 目录结构
- 实现所有核心模块
- 编写单元测试（122 个测试）

**完成的模块：**
- ✅ 类型定义（types/ 目录）
- ✅ 平台抽象层（platform/ 目录）
- ✅ MCP 服务器（server/ 目录）
- ✅ 截图工具（tools/ 目录）
- ✅ 工具函数（utils/ 目录）

---

### 阶段 5：平台适配问题

**提示词：**
```
我使用的是 wsl ubuntu，可以用于任务中 linux 平台的实现测试吗？
```

**说明：** 询问开发环境的适配性。

**回答：** 可以使用 WSL Ubuntu 测试 Linux 平台实现，但需要通过 `wsl` 命令进入。

---

### 阶段 6：优先级调整

**提示词：**
```
暂时先完成 windows 吧，我需要怎样才能看到截图效果，并在其他 ai 中使用
```

**说明：** 调整开发优先级，先完成 Windows 平台。

**关键决策：**
- 优先完成 Windows 平台实现
- 配置 MCP 服务器供 AI 使用
- 创建测试项目验证功能

---

### 阶段 7：测试项目配置

**提示词：**
```
我需要在 temp\pyscreeeshot-test 做一简单的项目，并在该目录项目中引入这个 mcp。给出方案我添加 mcp
```

**说明：** 创建测试项目来验证 MCP 功能。

**提示词：**
```
给我方案，我手动操作
```

**说明：** 要求提供配置方案，由用户手动操作。

**配置方案：**
- 在测试项目中创建 `.kiro/settings/mcp.json`
- 配置 MCP 服务器路径
- 重启 Kiro 加载配置

---

### 阶段 8：协议问题修复

**提示词：**
```
Error connecting to MCP server: MCP error -32601: Method not found: initialize
```

**说明：** 报告 MCP 协议初始化错误。

**问题分析：**
- Kiro 客户端调用 `initialize` 方法
- 服务器没有实现该方法
- 导致连接失败

**解决方案：** 在 MCPServer 类中添加 `handleInitialize` 方法，返回标准 MCP 协议响应。

**修复内容：**
- 添加 `initialize` 方法处理
- 返回协议版本（protocolVersion）、能力（capabilities）、服务器信息（serverInfo）
- 创建测试脚本验证完整协议流程

---

### 阶段 9：性能问题诊断

**提示词：**
```
窗口程序已经停止了。让我重新启动它，然后使用 MCP 截图...
这是 ai 使用 mcp 截图时的信息，到这里就停止了，没有任何输出
```

**说明：** AI 调用 MCP 工具时卡住，没有响应。

**问题现象：**
- AI 调用截图工具后无响应
- 没有错误信息
- 工具调用似乎挂起

**诊断过程：**
1. 添加服务器日志输出（stderr）
2. 创建性能测试脚本
3. 测试不同尺寸的截图

**诊断结果：**
- 大图片数据导致超时
- 200x200 截图约 213KB（< 1秒）
- 1920x1080 可能 10-20MB（超时）

**根本原因：**
- Base64 编码后数据量大
- JSON-RPC 传输大量数据
- Kiro 客户端超时

**解决方案：**
- 添加性能建议到工具描述
- 推荐使用 200x200 到 400x300 尺寸
- 创建 `capture_and_save` 工具一步完成截图和保存

---

### 阶段 10：保存截图功能

**提示词：**
```
我要怎么使用
```

**说明：** 询问如何使用 MCP 服务器。

**回答：** 提供了完整的配置和使用指南。

**后续需求（隐含）：**
- 需要保存截图到文件的功能
- AI 无法访问工具返回的 base64 数据
- 需要一步完成截图和保存

**实现内容：**
- 创建 `save_screenshot` 工具：保存 base64 图像到文件
- 创建 `capture_and_save` 工具：一步完成截图和保存（推荐）
- 支持自动创建目录、覆盖控制、PNG 格式

---

### 阶段 11：窗口标题查找功能

**提示词（隐含需求）：**
```
（用户希望通过窗口标题查找窗口）
```

**说明：** 用户希望 AI 可以直接说"截取简单的UI窗口"而不需要先查找句柄。

**实现内容：**
- 修改 `capture_window` 工具支持 `windowTitle` 参数
- 修改 `capture_and_save` 工具支持 `windowTitle` 参数
- 支持部分匹配（包含关系），区分大小写
- 更新工具描述和文档

**使用效果：**
- AI 可以直接使用窗口标题截图
- 不需要先调用 `list_windows`
- 简化了用户交互流程

---

### 阶段 12：进程名查找功能

**提示词：**
```
应该支持进程名进行查找
```

**说明：** 要求添加通过进程名查找窗口的功能。

**背景：**
- 用户希望说"截取 Python 窗口"就能直接截图
- 不想记住窗口句柄或完整标题
- 进程名更直观易用

**实现内容：**
- 添加 `processName` 参数到 `capture_window` 工具
- 添加 `processName` 参数到 `capture_and_save` 工具
- 支持不区分大小写匹配（"python" 匹配 "python.exe"、"Python.exe"）
- 三种查找方式：窗口句柄（windowHandle）、窗口标题（windowTitle）、进程名（processName）

**使用效果：**
- AI 可以说"截取 Python 窗口"直接使用进程名
- 更符合用户的自然语言习惯
- 简化了窗口查找流程

---

### 阶段 13：capture_and_save 进程名支持

**提示词：**
```
capture_and_save 没有支持进程名吗？
```

**说明：** 发现 `capture_and_save` 工具缺少进程名支持。

**问题：**
- `capture_window` 已支持 processName
- 但 `capture_and_save` 还没有
- 导致功能不一致

**解决方案：**
- 更新 `capture_and_save` 工具添加 `processName` 参数
- 确保两个工具功能一致
- 更新工具描述和文档

---

### 阶段 14：AI 接口说明完善

**提示词：**
```
ai 调用 mcp 时的接口说明中没有说明图片保存？
```

**说明：** 指出 AI 看到的工具描述中缺少保存功能说明。

**问题分析：**
- AI 调用 MCP 工具时依赖工具的描述（description）字段
- 如果描述中没有提到保存功能，AI 不知道该用哪个工具
- 导致 AI 可能使用错误的工具

**解决方案：**
- 更新 `capture_window` 描述，添加"重要提示：要将截图保存到文件，请使用 capture_and_save 工具"
- 更新 `capture_region` 描述，添加相同提示
- 确保 AI 能看到正确的使用指导

---

### 阶段 15：澄清需求

**提示词：**
```
我说的是 ai 调用 mcp 时的描写信息，而不是简单的文档
```

**说明：** 澄清不是要更新文档，而是要更新 AI 看到的接口描述。

**关键理解：**
- 用户关心的是 AI 调用时看到的信息
- 不是给人看的文档
- 是工具定义中的描述（description）字段

---

### 阶段 16：服务器总体描述完善

**提示词：**
```
ai 调用 mcp 时总的描述修改了没？而不仅是具体的接口信息
```

**说明：** 要求更新服务器总体描述信息，不仅是单个工具。

**理解：**
- 不仅要更新每个工具的描述
- 还要更新服务器的总体描述（服务器信息描述字段）
- 让 AI 从整体上了解这个 MCP 服务器的功能

**解决方案：**
- 更新服务器信息描述（serverInfo.description）包含完整功能说明
- 提到 5 个工具和 3 种窗口查找方式
- 更新包配置文件（package.json）描述保持一致

---

### 阶段 17：项目整理

**提示词：**
```
整理一下项目根目录文件，删除不需要的测试文件。整合文档，不需要的、过时的、临时的文档不要，进行整体整合
```

**说明：** 要求清理项目结构，整合文档。

**问题背景：**
- 根目录有很多测试文件（test-*.js, test-*.cjs）
- 有很多临时文档和过时文档
- 文档分散，不便于查阅

**执行内容：**
- 删除根目录所有测试文件（test-*.js、test-*.cjs）
- 删除 19 个过时/临时文档：
  - 故障排除文档（TROUBLESHOOTING.md）
  - MCP 使用文档（MCP_USAGE.md）
  - 快速开始文档（QUICK_START.md）
  - Kiro 测试指南（KIRO_TESTING_GUIDE.md）
  - MCP AI 接口说明（MCP_AI_INTERFACE.md）
  - 保存截图功能文档（SAVE_SCREENSHOT_FEATURE.md）
  - Kiro 解决方案文档（KIRO_WORKAROUND.md）
  - 窗口标题支持文档（WINDOW_TITLE_SUPPORT.md）
  - 进程名支持文档（PROCESS_NAME_SUPPORT.md）
  - 最新更新文档（LATEST_UPDATE.md）
  - 等等
- 创建文档目录（docs/）
- 整合为 2 个核心文档：
  - 用户指南（docs/USER_GUIDE.md）
  - API 文档（docs/API.md）
- 更新项目说明文件（README.md）作为项目入口
- 保留更新日志（CHANGELOG.md）记录版本历史

**整理原则：**
- 根目录保持简洁
- 文档集中管理
- 删除重复和过时内容
- 保留核心文档

---

### 阶段 18：纠正方向 - 补充测试

**提示词：**
```
不应该仅仅只是删除测试文件，项目本身也需要测试。现在增加项目测试
```

**说明：** 纠正 AI 的理解偏差，指出不应删除测试，而是组织测试结构。

**关键反馈：**
- 删除测试文件是错误的
- 项目需要测试
- 应该组织测试结构，而不是删除

**解决方案：**
- 创建集成测试目录（tests/integration/）
- 添加 3 个集成测试文件（ES 模块格式）：
  - MCP 协议测试（mcp-protocol.test.js）- 3 个测试
  - 服务器信息测试（server-info.test.js）- 1 个测试
  - 工具功能测试（tools.test.js）- 5 个测试
- 保留源代码中的单元测试（122 个）
- 更新包配置文件（package.json）测试命令：
  - `npm test` - 运行单元测试
  - `npm run test:integration` - 运行集成测试
  - `npm run test:all` - 运行所有测试
- 更新测试配置文件（vitest.config.ts）排除集成测试
- 创建测试说明文档（tests/README.md）

**测试结果：**
- 所有测试通过：131 个（122 单元 + 9 集成）

**经验教训：**
- 当 AI 理解偏差时，及时纠正
- 明确说明真正的需求
- 测试是项目的重要组成部分

---

### 阶段 19：提示词总结请求

**提示词：**
```
能不能帮我总结一下这个项目我用过的提示词
```

**说明：** 要求总结项目开发过程中使用的提示词。

**初次尝试：**
- AI 创建了提示词总结文档
- 但内容不够完整

---

### 阶段 20：重新整理提示词

**提示词：**
```
能不能帮我整理一下这个项目我用过的提示词
```

**说明：** 要求重新整理提示词总结，使其更完整。

**改进内容：**
- 补充了更多阶段的提示词
- 添加了关键提示词模式
- 添加了有效提示词技巧
- 添加了项目规范的作用

---

### 阶段 21：补充最早信息

**提示词：**
```
docs\PROMPTS_USED.md 最开始的部分不完全，应该有更早的信息
```

**说明：** 指出提示词文档缺少项目最初的 Spec 创建阶段。

**问题：**
- 文档从"继续"开始，缺少上下文
- 没有说明项目是如何启动的
- 缺少 Spec 创建的详细过程

**解决方案：**
- 补充阶段 0：项目概念和 Spec 启动
- 补充阶段 1：需求文档创建
- 补充阶段 2：设计文档创建
- 补充阶段 3：任务规划
- 详细说明 Kiro Spec 功能的使用
- 说明需求、设计、任务三个文档的创建过程

**完善内容：**
- 项目最初的启动提示词
- Spec 创建的隐式规则
- 需求定义过程（7 个核心需求）
- 设计过程（5 层架构、9 个正确性属性）
- 任务分解过程（17 个任务）

---

## 关键提示词模式

### 1. 渐进式开发

```
继续
暂时先完成 windows 吧
```

**特点：** 逐步推进，优先完成核心功能。

### 2. 问题报告

```
Error connecting to MCP server: MCP error -32601: Method not found: initialize
到这里就停止了，没有任何输出
```

**特点：** 直接粘贴错误信息，描述问题现象。

### 3. 功能需求

```
应该支持进程名进行查找
ai 调用 mcp 时的接口说明中没有说明图片保存？
```

**特点：** 明确指出需要的功能或缺失的内容。

### 4. 澄清确认

```
我说的是 ai 调用 mcp 时总的描述修改了没？而不仅是具体的接口信息
```

**特点：** 当 AI 理解有偏差时，明确说明真正的需求。

### 5. 操作指导

```
给我方案，我手动操作
整理一下项目根目录文件，删除不需要的测试文件
```

**特点：** 明确要求提供方案或执行特定操作。

### 6. 纠正反馈

```
不应该仅仅只是删除测试文件，项目本身也需要测试
```

**特点：** 当 AI 执行方向错误时，及时纠正。

---

## 有效提示词技巧

### ✅ 推荐做法

1. **直接粘贴错误信息**
   ```
   Error connecting to MCP server: MCP error -32601: Method not found: initialize
   ```

2. **明确具体需求**
   ```
   应该支持进程名进行查找
   ```

3. **描述问题现象**
   ```
   到这里就停止了，没有任何输出
   ```

4. **及时纠正方向**
   ```
   不应该仅仅只是删除测试文件
   ```

5. **澄清误解**
   ```
   我说的是 ai 调用 mcp 时总的描述，而不仅是具体的接口信息
   ```

### ❌ 避免做法

1. **过于模糊**
   ```
   ❌ 帮我改一下
   ✅ 应该支持进程名进行查找
   ```

2. **缺少上下文**
   ```
   ❌ 这个不对
   ✅ ai 调用 mcp 时的接口说明中没有说明图片保存
   ```

3. **一次要求太多**
   ```
   ❌ 同时完成 A、B、C、D 功能
   ✅ 暂时先完成 windows 吧
   ```

---

## 项目规范的作用

项目使用了 Kiro 的 Steering 功能，提供了以下规范：

1. **product.md** - 产品概述
2. **tech.md** - 技术栈
3. **structure.md** - 项目结构
4. **项目规范.md** - 编码规范

**优势：**
- AI 自动遵循项目规范
- 保持代码风格一致
- 中文文档，英文代码
- 单文件不超过 500 行

---

## 总结

### 项目完成情况

- ✅ 完整的 MCP 截图服务器
- ✅ 5 个工具，3 种窗口查找方式
- ✅ 131 个测试（122 单元 + 9 集成）
- ✅ 完整的文档（用户指南 + API 文档）
- ✅ 清晰的项目结构

### 关键成功因素

1. **渐进式开发** - 逐步完善功能
2. **及时反馈** - 发现问题立即报告
3. **明确需求** - 清楚表达想要的功能
4. **纠正方向** - 当 AI 理解偏差时及时纠正
5. **使用规范** - 通过 Steering 保持一致性

### 提示词精髓

**简洁、明确、具体、及时反馈**

- 简洁：不需要长篇大论
- 明确：清楚表达需求
- 具体：提供错误信息和现象
- 及时：发现问题立即反馈
